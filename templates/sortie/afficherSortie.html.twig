{%  extends ('pagetype.html.twig') %}





    {% block main %}

    <h2>Filtrer les sorties</h2>
<br>
<form method="post" class = "row" action="/afficher/afficSortieTriSite">


    <!-- recherche plus classique  -->
    <div class="col-5 offset-1">

        <!-- menu deroulant -->
        <div class="form-group row" style="padding-left: 15px;" >
            <label for="exampleFormControlSelect1 col-5 " > Site : </label>
            <select class="form-control col-5 offset-5" id="exampleFormControlSelect1" name="selectSite">
                {% for s in allSite  %}
                <option>{{ s.nom }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- recherche -->
        <div class="form-group row ">
            <label for="formGroupExampleInput" class="col-5"  >Le nom de la sortie contient :</label>
            <input type="text" class="form-control col-5 offset-1" id="formGroupExampleInput"  name="infoSearch">
        </div>


        <!-- recherche date-->
        <!--creation de la variable date du jour -->
        {% set date = "now" | date("Y-m-j")%}

        <div class="form-group row ">
        <label for="dateMini" class="col-2"  >Entre le : </label>
        <input type="date"   min="{{ date | date("Y-m-d") }}"  value="{{ date | date("Y-m-d") }}" name="dateMini" id="dateMini" class="col-4">

        <label for="dateMaxi" class="col-2"  > et le :</label>
        <input type="date"  min=""  value="{{ date | date("Y-m-d") }}"  name="dateMaxi" id="dateMaxi"  class="col-4">
        </div>

    </div>





    <!-- les checkbox -->
    <div class="col-5 offset-1">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
            <label class="form-check-label" for="defaultCheck1">
                Sorties dont je suis l'organisateur/trice
            </label>
        </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
        <label class="form-check-label" for="defaultCheck1">
            Sorties auxquelles je suis inscrit/e
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
        <label class="form-check-label" for="defaultCheck1">
            Sorties auxquelles je ne suis pas inscrit/e
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
        <label class="form-check-label" for="defaultCheck1">
            Sorties passées
        </label>
    </div>

<br>


        <!-- et le boutton de recherche -->
        <div class="button-">
            <button type="submit" class="btn btn-info" id="seek">Rechercher</button>
        </div>

    </div>
</form>

<br>

<!-- -------------------------------------------------------------------------------------------- -->
    <!-- Affichage des informations sur les sorties -->

        {% if allSortie %}

<div class="row col-11 offset-1">
        {% for s in allSortie  %}


            <!-- on compte le nombre de participant pour chaque sorti (nbP) -->
            <!-- on vérifie que l'utilisteur n'est pas deja inscrit (UInscrit) -->
            {% set nbP = 0 %}
            {% set UInscrit = false %}
            {% set Plein = false %}
            {% for p in s.Participant %}
                {% set nbP = nbP + 1 %}
                  {% if  p == app.user%}
                    {% set UInscrit = true %}
                  {% endif %}
            {% endfor %}
            <!-- on vérifie qu'il reste de la place pour pouvoir s'inscrire -->
            {% if nbP == s.nbInscriptionsMax %}
                {% set Plein = true %}
            {% endif %}


        {# création d'un block#}
        <div class="col-12 col-lg-3 offset-1 border border-primary rounded m-2">

        <!-- on affiche l'image en fonction de la categorie -->
            <div class="justify-content-md-center">
            {% if s.categorie.libelle == "sport" %}
            <img src="{{asset('build/images/sport.svg')}}" alt="sport" class="image-picto-m">
            {% elseif s.categorie.libelle == "musique" %}
            <img src="{{asset('build/images/musique.svg')}}" alt="musique" class="image-picto-m">
            {% elseif s.categorie.libelle == "culture" %}
            <img src="{{asset('build/images/culture.svg')}}" alt="culture" class="image-picto-m">
            {% elseif s.categorie.libelle == "informatique" %}
            <img src="{{asset('build/images/informatique.svg')}}" alt="informatique" class="image-picto-m">
            {% elseif s.categorie.libelle == "apero" %}
            <img src="{{asset('build/images/aperitif.svg')}}" alt="aperitif" class="image-picto-m">
            {% else %}
            <img src="{{asset('build/images/divers.svg')}}" alt="divers" class="image-picto-m">
            {% endif %}
            </div>

            <!-- on affiche les autres infos -->
            <h2>{{s.nom}}</h2>
            <p>Date de la sortie : le {{ s.dateHeureDebut |date("d/m/Y à H:i") }}</p>
            <p>Nb d'inscrit : {{ nbP }} / Nb place : {{s.nbInscriptionsMax}}</p>
            <p>Organisateur : <a href="#">{{ s.Organisateur }}</a></p>
            <div class="row p-2 text-center">
             <a href="{{ path('sortie_show', {'id': s.id}) }}" class="offset-1 col-4"><button class="btn btn-primary ">Afficher</button></a>

            <!-- si l'user n'est pas inscrit apparition du boutton inscription -->
            {% if UInscrit == false  and Plein == false %}
                <button value="{{ s.id }}" class="inscription offset-1 col-4 btn btn-success" >s'incrire</button>
            {% endif %}

            <!-- si l'user est inscrit apparition du boutton pour se desinscrire -->
            {% if UInscrit == true %}
                <button value="{{ s.id }}" class="desincription offset-1 col-5 btn btn-danger" >desinscription</button>
            {% endif %}
            </div>
    <br>

</div>

        {% endfor %}
</div>
        {% endif %}

{% endblock %}



{% block javascripts %}

    <!-- lien avec le fichier js -->

    {{ encore_entry_script_tags('affiche') }}

{% endblock %}