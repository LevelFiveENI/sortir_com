{%  extends ('pagetype.html.twig') %}





    {% block main %}

    <h2>Filtrer les sorties</h2>
<br>
<form method="post" class = "row" action="/afficher/afficSortieTriSite">


    <!-- recherche plus classique  -->
    <div class="col-5 offset-1">

        <!-- menu deroulant -->
        <div class="form-group row" style="padding-left: 15px;" >
            <label for="exampleFormControlSelect1 col-5 " > Site : </label>
            <select class="form-control col-5 offset-5" id="exampleFormControlSelect1" name="selectSite">
                {% for s in allSite  %}
                <option>{{ s.nom }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- recherche -->
        <div class="form-group row ">
            <label for="formGroupExampleInput" class="col-5"  >Le nom de la sortie contient :</label>
            <input type="text" class="form-control col-5 offset-1" id="formGroupExampleInput"  name="infoSearch">
        </div>


        <!-- recherche date-->
        <!--creation de la variable date du jour -->
        {% set date = "now" | date("Y-m-j")%}

        <div class="form-group row ">
        <label for="dateMini" class="col-2"  >Entre le : </label>
        <input type="date"   min="{{ date | date("Y-m-d") }}"  value="{{ date | date("Y-m-d") }}" name="dateMini" id="dateMini" class="col-4">

        <label for="dateMaxi" class="col-2"  > et le :</label>
        <input type="date"  min=""  value="{{ date | date("Y-m-d") }}"  name="dateMaxi" id="dateMaxi"  class="col-4">
        </div>

    </div>





    <!-- les checkbox -->
    <div class="col-5 offset-1">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
            <label class="form-check-label" for="defaultCheck1">
                Sorties dont je suis l'organisateur/trice
            </label>
        </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
        <label class="form-check-label" for="defaultCheck1">
            Sorties auxquelles je suis inscrit/e
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
        <label class="form-check-label" for="defaultCheck1">
            Sorties auxquelles je ne suis pas inscrit/e
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
        <label class="form-check-label" for="defaultCheck1">
            Sorties passées
        </label>
    </div>

<br>


        <!-- et le boutton de recherche -->
        <div class="button-">
            <button type="submit" class="btn btn-primary" id="seek">Rechercher</button>
        </div>

    </div>


</form>

<br>


    <!-- Affichage des informations sur les sorties -->

    <table class="table table-striped table-bordered offset-1 col-10">
        <thead>
        <tr>
            <th scope="col">Nom de la sortie</th>
            <th scope="col">Date de la sortie</th>
            <th scope="col">Clôture</th>
            <th scope="col">Inscrit / places</th>
            <th scope="col">Etat</th>
            <th scope="col">Inscrit</th>
            <th scope="col">Organisateur</th>
            <th scope="col">Actions</th>

        </tr>
        </thead>
        <tbody>
        {% if allSortie %}
{% for s in allSortie  %}
        <tr>
            <th scope="row"> {{s.nom}} </th>
            <td>{{ s.dateHeureDebut |date("d/m/Y à H:i") }}</td>
            <td>{{s.dateLimiteInscription |date("d/m/Y") }}</td>

            <!-- on compte le nombre de participant pour chaque sorti (nbP) -->
            <!-- on vérifie que l'utilisteur n'est pas deja inscrit (UInscrit) -->
            {% set nbP = 0 %}
            {% set UInscrit = false %}
            {% set Plein = false %}
            {% for p in s.Participant %}
                {% set nbP = nbP + 1 %}
                {% if  p == app.user%}
                    {% set UInscrit = true %}
                {% endif %}
            {% endfor %}
            <!-- on vérifie qu'il reste de la place pour pouvoir s'inscrire -->
            {% if nbP == s.nbInscriptionsMax %}
                {% set Plein = true %}
            {% endif %}


            <td>{{ nbP }} / {{s.nbInscriptionsMax}}</td>
            <td>{{s.etat.libelle}}</td>
            <td>inscrit</td>
            <td>organisateur</td>
            <td>
            <a href="{{ path('sortie_show', {'id': s.id}) }}">Afficher</a>
            <a href="{{ path('sortie_edit', {'id': s.id}) }}">Modifier</a>


                <!-- si l'user n'est pas inscrit apparition du boutton inscription -->
                {% if UInscrit == false  and Plein == false %}
                    <button value="{{ s.id }}" class="inscription" >s'incrire</button>
                {% endif %}

                <!-- si l'user est inscrit apparition du boutton pour se desinscrire -->
                {% if UInscrit == true %}
                    <button value="{{ s.id }}" class="desincription" >desinscription</button>
                {% endif %}




            </td>
        </tr>
      {% endfor %}
        {% endif %}
        </tbody>
    </table>

{% endblock %}




{% block javascripts %}

    <!-- lien avec le fichier js -->

    {{ encore_entry_script_tags('affiche') }}

{% endblock %}