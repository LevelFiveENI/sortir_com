{% extends 'base.html.twig' %}

{% block title %}New Sortie{% endblock %}

{% block body %}
    <h1>Crée un nouvelle Sortie</h1>

    <!--Formulaire de création d'un sortie -->
    {{ form_start(form) }}
    {{ form_widget(form) }}


    <label for="sortie_lieu">Choisir un lieu</label>
        <select id="sortie_lieu" name="choixLieu">
            <option value="" disabled selected>Choisir un lieu</option>
        </select>
    <br>
    <!-- Modal pour la création du lieu -->
    <button type="button" id="newLieu" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" >
        Ajouter un lieu
    </button>
    <br>
    <button class="btn">{{ button_label|default('Créer la sortie') }}</button>

    {{ form_end(form) }}

    <a href="{{ path('sortie_index') }}">Voir la liste des Sorties</a>

    <!--Formulaire de création d'un sortie -->
    <div id="successLieu"></div>




    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {{ form_start(formLieu, {'attr': {'id': 'ajoutLieu'}}) }}
                    {{ form_widget(formLieu) }}
                    <button class="btn">{{ button_label|default('Save') }}</button>
                    {{ form_end(formLieu) }}

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block javascripts %}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>#}
    <script>

        $("#sortie_ville").change(function() {
            $.ajax({
                //Appeler la nouvelle fonction
                url: "{{ path('ajax_lieu') }}",
                type: "POST",
                dataType:"json",
                data: {
                    villeid: $("#sortie_ville").val()
                },

                success: function (json) {
                    console.log(json);
                    $('#sortie_lieu').empty();
                    $.each(json, function(i, optionHtml){
                        $('#sortie_lieu').append($('<option>').text(optionHtml)
                    .attr( { name:"nomLieu", value:i } ))
                    })

                },
                error: function (err) {
                    alert("An error ocurred while loading data ...");
                }
            });
        });

        $("#ajoutLieu").submit(function(event) {
            event.preventDefault();

            $.ajax({
                //Appeler la nouvelle fonction
                url: "{{ path('lieu_new') }}",
                type: "POST",
                dataType:"json",
                 data: {
                     newLieuNom: $("#lieu_nom").val(),
                     newLieuRue: $("#lieu_rue").val(),
                     newLieuVille: $("#lieu_nomVille").val()
                 },

                success: function () {
                    $("#exampleModal").modal('hide');

                },
                error: function () {
                    $("#exampleModal").modal('hide');
                    $("#successLieu").html($("#lieu_nom").val() + "à été ajouté !");
                    $("#lieu_nom").empty();
                    $("#lieu_rue").empty();

                }
            });
        });


    </script>
{% endblock %}

